---
title: "thesis_data_regression_1_final"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(devtools)
library(readxl)
library(foreign)
library(plm)
library(lmtest)
library(janitor)
library(stargazer)
library(broom)
library(gt)
library(tidyverse)
```

```{r load currency data}

#currency in circulation 

ifs_cic <- read_xlsx("raw-data/international_financial_statistics_ updated.xlsx") %>%
  gather(year, value, -c(country)) %>%
  drop_na() %>%
  mutate(cic = value * 1000000) %>%
  select(-value) %>%
  mutate(year = as.numeric(year)) %>%
filter(year != "1997") %>%
filter(year != "1998") %>%
filter(year != "1999") 

#gdp

gdp_final <- read_csv("raw-data/gdp_weo_2.csv", skip = 4) %>%
select(-`Indicator Name`, -`Indicator Code`) %>%
gather(year, value, -c(`Country Name`, `Country Code`)) %>%
filter(value != "NA") %>%
rename(country = `Country Name`) %>%
rename(country_code = `Country Code`) %>%
mutate(year = as.numeric(year)) %>%
rename(gdp = value)

#cash demand
 
cash_demand <- ifs_cic %>%
full_join(gdp_final, by = c("year", "country")) %>%
mutate(cd = cic/gdp) %>%
mutate(log_cd = log(cd)) %>%
mutate(log_cic = log(cic)) %>%
filter(log_cd != "-Inf") %>%
arrange(desc(cd))


```

```{r load explanatory variables data sets}

#interest rates

deposit_interest_rate <- read_csv("raw-data/interest_rates_wdi.csv", skip = 4) %>%
select(-`Indicator Name`, -`Indicator Code`) %>%
gather(year, value, -c(`Country Name`, `Country Code`)) %>%
filter(value != "NA") %>%
rename(country = `Country Name`) %>%
rename(country_code = `Country Code`) %>%
mutate(year = as.numeric(year)) %>%
rename(deposit_interest_rate = value) 

treasury_bill_rate <- read_xlsx("raw-data/imf_treasury_bill_interest_rates.xlsx", skip = 5) %>%
select(-`Scale`, -`Base Year`) %>%
gather(Year, Value, -c(Country)) %>%
filter(Value != "...") %>%
rename(year = Year) %>%
rename(treasury_bill_rate = Value) %>%
mutate(treasury_bill_rate = as.numeric(treasury_bill_rate)) %>%
mutate(treasury_bill_rate = round(treasury_bill_rate, digits = 4)) %>%
rename(country = Country) %>%
mutate(year = as.numeric(year)) %>%
filter(year != "NA")  

#economic complexity index

eci <- read_csv("raw-data/eci_country_rankings.csv")  %>%
clean_names() %>%
select(-country_id) %>%
mutate(year = as.numeric(year))

eci_ea <- eci %>%
  mutate(euro_area = ifelse(country %in% c("Germany", "Spain", "France", "Italy", "Netherlands", "Austria", "Belgium", "Cyprus", "Estonia", "Finland", "Greece", "Ireland", "Lithuania", "Portugal", "Slovakia", "Slovenia"), 1, 0)) %>%
  filter(euro_area == 1) %>%
  group_by(year) %>%
  summarize(eci = mean(eci)) %>%
  mutate(country = "Euro Area") 

eci_final <- eci_ea %>%
  full_join(eci, by = c("country", "year", "eci"))

#uncertainty index

uncertainty <- read_excel("raw-data/uncertainty.xlsx") %>%
mutate(year = str_sub(year, 1,4)) %>%
mutate_all(as.character) %>%
mutate(year = as.numeric(year)) %>%
pivot_longer(-year, names_to = "country_code", values_to = "uncertainty") %>%
mutate(uncertainty = as.numeric(uncertainty)) %>%
group_by(country_code, year) %>%
summarize(uncertainty = mean(uncertainty, na.rm = TRUE))

uncertainty_ea <- uncertainty %>%
  mutate(euro_area = ifelse(country_code %in% c("DEU", "ESP", "FRA", "ITA", "NLD", "IRL"), 1, 0)) %>%
  filter(euro_area == 1) %>%
  group_by(year) %>%
  summarize(uncertainty = mean(uncertainty)) %>%
  mutate(country_code = "EMU")

uncertainty_final <- uncertainty_ea %>%
  full_join(uncertainty, by = c("country_code", "year", "uncertainty"))

#tax to gdp

tax_gdp_final <- read_csv("raw-data/tax_gdp.csv", skip = 4) %>%
select(-`Indicator Name`, -`Indicator Code`) %>%
gather(year, value, -c(`Country Name`, `Country Code`)) %>%
rename(country = `Country Name`) %>%
mutate(year = as.numeric(year)) %>%
mutate(country = as.character(country)) %>%
rename(country_code = `Country Code`) %>%
drop_na() %>%
rename(tax_gdp = value) 


#economic freedom indicies 

economic_freedom <- read_csv("raw-data/data.csv") %>%
  clean_names() %>%
  rename(country = name) %>%
  rename(year = index_year) %>%
  mutate(overall_score = as.numeric(overall_score)) %>%
  mutate(business_freedom = as.numeric(business_freedom)) %>%
  mutate(monetary_freedom = as.numeric(monetary_freedom)) %>%
  mutate(financial_freedom = as.numeric(financial_freedom)) %>%
  mutate(investment_freedom = as.numeric(investment_freedom)) %>%
  mutate(trade_freedom = as.numeric(trade_freedom)) %>%
  mutate(government_integrity = as.numeric(government_integrity)) %>%
  mutate(judicial_effectiveness = as.numeric(judicial_effectiveness)) %>%
  mutate(tax_burden = as.numeric(tax_burden)) %>%
  mutate(government_spending = as.numeric(government_spending)) %>%
  mutate(property_rights = as.numeric(property_rights)) %>%
  mutate(fiscal_health = as.numeric(fiscal_health)) %>%
  mutate(labor_freedom = as.numeric(labor_freedom))

economic_freedom_ea <- economic_freedom %>%
  mutate(euro_area = ifelse(country %in% c("Germany", "Spain", "France", "Italy", "Netherlands", "Austria", "Belgium", "Cyprus", "Estonia", "Finland", "Greece", "Ireland", "Latvia", "Lithuania", "Luxembourg", "Malta", "Portugal", "Slovakia", "Slovenia"), 1, 0)) %>%
  filter(euro_area == 1) %>%
  group_by(year) %>%
  summarize(monetary_freedom = mean(monetary_freedom, na.rm = TRUE),
          business_freedom = mean(business_freedom, na.rm = TRUE),
          property_rights = mean(property_rights, na.rm = TRUE),
          investment_freedom = mean(investment_freedom, na.rm = TRUE),
          financial_freedom = mean(financial_freedom, na.rm = TRUE), 
          trade_freedom = mean(trade_freedom, na.rm = TRUE),
          government_integrity = mean(government_integrity, na.rm = TRUE),
          judicial_effectiveness = mean(judicial_effectiveness, na.rm = TRUE)) %>%
  mutate(country = "Euro Area") 

economic_freedom_final <- economic_freedom_ea %>%
  full_join(economic_freedom, by = c("country", "year", "monetary_freedom", "business_freedom", "property_rights", "investment_freedom", "financial_freedom", "trade_freedom", "government_integrity", "judicial_effectiveness")) %>%
  arrange(country, year)

#estimates of the shadow economy 

shadow_economy <- read_xlsx("raw-data/shadow_economy.xlsx") %>%
select(-`No.`, -`Av. over years`) %>%
gather(year, value, -c(`Country`)) %>%
rename(country = `Country`) %>%
rename(shadow_economy = value) %>%
mutate(shadow_economy = as.numeric(shadow_economy)) %>%
arrange(country, year) %>%
mutate(year = as.numeric(year)) 

shadow_economy_ea <- shadow_economy %>%
  mutate(euro_area = ifelse(country %in% c("Germany", "Spain", "France", "Italy", "Netherlands", "Austria", "Belgium", "Cyprus", "Estonia", "Finland", "Greece", "Ireland", "Latvia", "Lithuania", "Luxembourg", "Malta", "Portugal", "Slovakia", "Slovenia"), 1, 0)) %>%
  filter(euro_area == 1) %>%
  group_by(year) %>%
  summarize(shadow_economy = mean(shadow_economy)) %>%
   mutate(country = "Euro Area") 
  
shadow_economy_final <- shadow_economy_ea %>%
  full_join(shadow_economy, by = c("country", "year", "shadow_economy"))

#urbanization 

urbanization_final <- read_csv("raw-data/urbanization.csv", skip = 4) %>%
select(-`Indicator Name`, -`Indicator Code`) %>%
gather(year, value, -c(`Country Name`, `Country Code`)) %>%
filter(value != "NA") %>%
rename(country = `Country Name`) %>%
rename(country_code = `Country Code`) %>%
mutate(year = as.numeric(year)) %>%
mutate(value = round(value, digits = 3)) %>%
rename(urbanization = value) 

#urban population growth

urban_pop_growth_final <- read_csv("raw-data/urban_pop_growth.csv", skip = 4) %>%
  select(-`Indicator Name`, -`Indicator Code`)%>%
gather(year, value, -c(`Country Name`, `Country Code`)) %>%
filter(value != "NA") %>%
rename(country = `Country Name`) %>%
rename(country_code = `Country Code`) %>%
mutate(year = as.numeric(year)) %>%
rename(urban_pop_growth = value) 

#crime statistics 

crime_final <- read_csv("raw-data/intentional_homocide.csv", skip = 3) %>%
select(-`Indicator Name`, -`Indicator Code`) %>%
gather(year, value, -c(`Country Name`, `Country Code`)) %>%
filter(value != "NA") %>%
rename(country = `Country Name`) %>%
rename(country_code = `Country Code`) %>%
mutate(year = as.numeric(year)) %>%
rename(crime = value) 


```

```{r full data set creation}

final_regression_1_data <- cash_demand %>%
  full_join(deposit_interest_rate, by = c("country", "country_code", "year")) %>%
  full_join(treasury_bill_rate, by = c("country", "year")) %>%
  full_join(tax_gdp_final, by = c("country", "country_code", "year")) %>%
  full_join(eci_final, by = c("country", "year")) %>%
  full_join(uncertainty_final, by = c("country_code", "year")) %>%
  full_join(economic_freedom_final, by = c("country", "year")) %>%
  full_join(shadow_economy_final, by = c("country", "year")) %>%
  full_join(urbanization_final, by = c("country", "country_code", "year")) %>%
  full_join(crime_final, by = c("country", "country_code", "year")) %>%
  full_join(urban_pop_growth_final, by = c("country", "country_code", "year")) %>%
  mutate(region = ifelse(country %in% c("Australia", "Brunei Darussalam", "Cambodia", "Fiji", "Hong Kong", "Indonesia", "Japan", "Korea, Rep.", "Macao", "Malaysia", "Mongolia", "Myanmar", "Thailand", "Papua New Guinea", "Philippines", "Samoa", "Singapore", "Solomon Islands", "Tonga", "Vanuatu", "New Zealand"), "East Asia and Pacific",
          ifelse(country %in% c("Albania", "Armenia", "Azerbaijan", "Belarus", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Czech Republic", "Denmark", "Euro Area", "Georgia", "Hungary", "Iceland", "Kazakhstan", "Kyrgyz Republic", "Moldova", "North Macedonia", "Norway", "Poland", "Romania", "Serbia", "Sweden", "Switzerland", "Tajikistan", "Turkey", "Ukraine", "United Kingdom"), "Europe and Central Asia", 
           ifelse(country %in% c("Antigua and Barbuda", "Argentina", "Bahamas", "Barbados", "Belize", "Bolivia", "Brazil", "Chile", "Colombia", "Costa Rica", "Dominica", "Dominican Republic", "Grenada", "Guatemala", "Guyana", "Haiti", "Honduras", "Jamaica", "Mexico", "Nicaragua", "Panama", "Paraguay", "Peru", "St. Kitts and Nevis", "St. Lucia", "St. Vincent and the Grenadines", "Suriname", "Trinidad and Tobago", "Uruguay", "Venezuela, RB"), "Latin America and The Caribbean",
            ifelse(country %in% c("Algeria", "Djibouti", "Egypt", "Iraq", "Israel", "Jordan", "Kuwait", "Morocco", "Oman", "Qatar", "Syrian Arab Republic", "Tunisia", "United Arab Emirates"), "Middle East and North Africa", 
             ifelse(country %in% c("Canada", "United States"), "North America",
              ifelse(country %in% c("Afghanistan", "Bangladesh", "Bhutan", "India", "Maldives", "Nepal", "Pakistan", "Sri Lanka"), "South Asia",
               ifelse(country %in% c("Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Congo DR", "Congo, Rep.", "Cote d'Ivoire", "Equatorial Guinea", "Eritrea", "Eswatini", "Gabon", "Ghana", "Guinea-Bissau", "Kenya", "Lesotho", "Liberia", "Madagascar", "Mali", "Mauritania", "Mauritius", "Mozambique", "Namibia", "Niger", "Nigeria", "Rwanda", "Sao Tome and Principe", "Senegal", "Seychelles", "Sierra Leone", "South Africa", "South Sudan", "Sudan", "Tanzania", "Togo", "Uganda", "Zambia", "Zimbabwe"), "Sub-Saharan Africa", "NA")))))))) %>%
   mutate(development = ifelse(country %in% c("Afghanistan", "Benin", "Burkina Faso", "Burundi", "Central African Republic", "Chad", "Congo DR", "Eritrea", "Guinea-Bissau", "Haiti", "Liberia", "Madagascar", "Mali", "Mozambique", "Nepal", "Niger", "Rwanda", "Sierra Leone", "South Sudan", "Syrian Arab Republic", "Tajikistan", "Tanzania", "Togo", "Uganda"), "Low-Income Economies",
                        ifelse(country %in% c("Angola", "Bangladesh", "Bhutan", "Bolivia", "Cabo Verde", "Cambodia", "Cameroon", "Comoros", "Congo, Rep.", "Cote d'Ivoire", "Djibouti", "Egypt", "Eswatini", "Ghana", "Honduras", "India", "Indonesia", "Kenya", "Kyrgyz Republic", "Lesotho", "Mauritania", "Moldova", "Mongolia", "Morocco", "Myanmar", "Nicaragua", "Nigeria", "Pakistan", "Papua New Guinea", "Philippines", "Sao Tome and Principe", "Senegal", "Solomon Islands", "Sudan", "Tunisia", "Ukraine", "Vanuatu", "Zambia", "Zimbabwe"), "Lower-Middle-Income Economies", 
                        ifelse(country %in% c("Albania", "Algeria", "Argentina", "Armenia", "Azerbaijan", "Belarus", "Belize", "Bosnia and Herzegovina", "Botswana", "Brazil", "Bulgaria", "Colombia", "Costa Rica", "Dominica", "Dominican Republic", "Equatorial Guinea", "Fiji", "Gabon", "Georgia", "Grenada", "Guatemala", "Guyana", "Iraq", "Jamaica", "Jordan", "Kazakhstan", "Malaysia", "Maldives", "Mauritius", "Mexico", "Namibia", "North Macedonia", "Paraguay", "Peru", "Romania", "Samoa", "Serbia", "Sri Lanka", "South Africa", "St. Lucia", "St. Vincent and the Grenadines", "Suriname", "Thailand", "Tonga", "Turkey", "Venezuela, RB"), "Upper-Middle-Income Economies",
                        ifelse(country %in% c("Antigua and Barbuda", "Australia", "Bahamas", "Barbados", "Brunei Darussalam", "Canada", "Chile", "Croatia", "Czech Republic", "Denmark", "Euro Area", "Hong Kong", "Hungary", "Iceland", "Israel", "Japan", "Korea, Rep.", "Kuwait", "Macao", "New Zealand", "Norway", "Oman", "Panama", "Poland", "Qatar", "Seychelles", "Singapore", "St. Kitts and Nevis", "Sweden", "Switzerland", "Trinidad and Tobago", "United Arab Emirates", "United Kingdom", "United States", "Uruguay"), "High-Income Economies", "NA"))))) %>%
arrange(country, year) %>%
filter(cic != "NA")

write.csv(final_regression_1_data, "final_regression_1_data.csv")

```